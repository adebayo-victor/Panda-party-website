<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Validation</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a09; /* Deep stone background */
        }
        /* Custom styles for the message box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            transition: opacity 0.3s ease-in-out;
        }
        .keypad-button {
            @apply bg-stone-800 text-white text-4xl font-bold py-6 rounded-xl shadow-lg
                   hover:bg-stone-700 active:bg-stone-600 transition-all duration-150
                   transform active:scale-95;
        }
        .keypad-button-action {
            @apply bg-violet-700 text-white text-3xl font-bold py-6 rounded-xl shadow-lg
                   hover:bg-violet-600 active:bg-violet-500 transition-all duration-150
                   transform active:scale-95;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <!-- Message Box for user feedback -->
    <div id="message-box" class="message-box"></div>

    <div class="bg-stone-900 p-8 rounded-xl shadow-lg w-full max-w-md border border-stone-800">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-white">Validate Ticket</h1>
            <p class="mt-2 text-stone-400">Enter the 6-digit ticket code</p>
        </div>

        <!-- Code Display -->
        <div class="bg-stone-800 text-white text-5xl font-mono tracking-widest p-6 rounded-lg text-center mb-8 border border-stone-700">
            <span id="code-display">______</span>
        </div>

        <!-- Validation Status Display -->
        <div id="validation-status" class="flex flex-col items-center justify-center h-24 mb-8 hidden">
            <div id="status-icon" class="text-6xl mb-2"></div>
            <p id="status-message" class="text-xl font-semibold"></p>
        </div>

        <!-- Keypad -->
        <div class="grid grid-cols-3 gap-4">
            <button class="keypad-button" data-value="1">1</button>
            <button class="keypad-button" data-value="2">2</button>
            <button class="keypad-button" data-value="3">3</button>
            <button class="keypad-button" data-value="4">4</button>
            <button class="keypad-button" data-value="5">5</button>
            <button class="keypad-button" data-value="6">6</button>
            <button class="keypad-button" data-value="7">7</button>
            <button class="keypad-button" data-value="8">8</button>
            <button class="keypad-button" data-value="9">9</button>
            <button class="keypad-button-action" id="clear-btn">Clear</button>
            <button class="keypad-button" data-value="0">0</button>
            <button class="keypad-button-action" id="backspace-btn">
                <svg class="h-8 w-8 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M12 12l-2 2m0 0l-2-2m2 2l2-2m-2 2l-2 2m8-4H4"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const codeDisplay = document.getElementById('code-display');
            const keypadButtons = document.querySelectorAll('.keypad-button');
            const clearBtn = document.getElementById('clear-btn');
            const backspaceBtn = document.getElementById('backspace-btn');
            const messageBox = document.getElementById('message-box');
            const validationStatus = document.getElementById('validation-status');
            const statusIcon = document.getElementById('status-icon');
            const statusMessage = document.getElementById('status-message');

            let currentCode = '';
            const MAX_DIGITS = 6;

            function updateCodeDisplay() {
                const displayValue = currentCode.padEnd(MAX_DIGITS, '_');
                codeDisplay.textContent = displayValue;
            }

            function showMessage(message, duration = 3000) {
                messageBox.textContent = message;
                messageBox.style.display = 'block';
                messageBox.style.opacity = '1';
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    setTimeout(() => {
                        messageBox.style.display = 'none';
                    }, 300); // Wait for fade-out transition
                }, duration);
            }

            function showValidationStatus(type, message) {
                validationStatus.classList.remove('hidden');
                statusMessage.textContent = message;

                // Reset colors and remove previous icons
                statusIcon.innerHTML = '';
                statusMessage.classList.remove('text-green-400', 'text-red-400');

                if (type === 'valid') {
                    statusIcon.innerHTML = '<svg class="h-16 w-16 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    statusMessage.classList.add('text-green-400');
                } else if (type === 'used' || type === 'invalid') {
                    statusIcon.innerHTML = '<svg class="h-16 w-16 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    statusMessage.classList.add('text-red-400');
                }

                // Hide status after a few seconds
                setTimeout(() => {
                    validationStatus.classList.add('hidden');
                    statusIcon.innerHTML = '';
                    statusMessage.textContent = '';
                }, 7000);
            }

            async function validateCode(code) {
                showMessage('Validating code...', 2000); // Show loading message
                try {
                    const response = await fetch('https://hhxsq4xb-5000.uks1.devtunnels.ms/validation', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code: code })
                    });
                    const result = await response.json();

                    if (result.response === 'valid') {
                        showValidationStatus('valid', 'Ticket is Valid!');
                    } else if (result.response === 'used') {
                        showValidationStatus('used', 'Ticket has been Used.');
                    } else if (result.response === 'invalid') {
                        showValidationStatus('invalid', 'Invalid Ticket Code.');
                    } else {
                        showMessage('Unexpected response from server.');
                    }
                } catch (error) {
                    showMessage('Error validating ticket: ' + error.message);
                    console.error('Validation error:', error);
                } finally {
                    // Clear the code after validation attempt
                    currentCode = '';
                    updateCodeDisplay();
                }
            }

            // Add event listeners for number buttons
            keypadButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (currentCode.length < MAX_DIGITS) {
                        currentCode += button.dataset.value;
                        updateCodeDisplay();
                        if (currentCode.length === MAX_DIGITS) {
                            validateCode(currentCode);
                        }
                    }
                });
            });

            // Event listener for Clear button
            clearBtn.addEventListener('click', () => {
                currentCode = '';
                updateCodeDisplay();
                validationStatus.classList.add('hidden'); // Hide status on clear
            });

            // Event listener for Backspace button
            backspaceBtn.addEventListener('click', () => {
                currentCode = currentCode.slice(0, -1);
                updateCodeDisplay();
                validationStatus.classList.add('hidden'); // Hide status on backspace
            });

            // Initial display update
            updateCodeDisplay();
        });
    </script>
</body>
</html>
